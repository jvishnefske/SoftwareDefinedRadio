(kicad_sch
  (version 20231120)
  (generator "eeschema")
  (generator_version "8.0")
  (uuid "mcu-stm32g4-uuid-001")
  (paper "A3")
  (title_block
    (title "MCU - STM32G474")
    (date "2024-12-24")
    (rev "2.0")
    (comment 1 "ARM Cortex-M4F (UCPD unused - TPS25750D handles PD)")
    (comment 2 "JLCPCB Part: C481410")
  )


  (text "STM32G474RET6 - ARM Cortex-M4F @ 170MHz"
    (exclude_from_sim no)
    (at 38.1 30.48 0)
    (effects (font (size 2.5 2.5) bold) (justify left))
    (uuid "text-mcu-title")
  )

  (text "STM32G474RET6 Features:\n• 512KB Flash, 128KB RAM\n• 170MHz Cortex-M4F with FPU/DSP\n• USB Full-Speed (UCPD unused)\n• 5x 12-bit ADC (4 MSPS)\n• 2x 12-bit DAC\n• HRTIM for precise PWM\n• 4x I2C, 4x SPI, 5x UART\n\nLCSC Part: C481410\nPackage: LQFP-64\n\nPin Assignments (Key):\n• PA0: PTT Input\n• PA4: Audio DAC Out\n• PA11/PA12: USB D-/D+\n• PB4: TPS25750D INT (optional)\n• PB5: GPIO Spare\n• PB6/PB7: I2C1 SCL/SDA\n• PC0/PC1: ADC (SWR FWD/REV)\n• PC2: ADC (Audio In)\n\nNote: USB-PD handled by TPS25750D\nMCU UCPD peripheral not used"
    (exclude_from_sim no)
    (at 38.1 45.72 0)
    (effects (font (size 1.27 1.27)) (justify left))
    (uuid "text-mcu-features")
  )

  (text "8MHz HSE Crystal"
    (exclude_from_sim no)
    (at 190.5 38.1 0)
    (effects (font (size 2 2) bold) (justify left))
    (uuid "text-crystal-title")
  )

  (symbol
    (lib_id "Device:Crystal")
    (at 203.2 55.88 0)
    (unit 1)
    (exclude_from_sim no)
    (in_bom yes)
    (on_board yes)
    (dnp no)
    (uuid "y-hse")
    (property "Reference" "Y1"
      (at 203.2 48.26 0)
      (effects (font (size 1.27 1.27)))
    )
    (property "Value" "8MHz"
      (at 203.2 50.8 0)
      (effects (font (size 1.27 1.27)))
    )
    (property "Footprint" "Crystal:Crystal_HC49-4H_Vertical"
      (at 203.2 55.88 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "LCSC" "C32160"
      (at 203.2 55.88 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "JLC_Basic" "Yes"
      (at 203.2 55.88 0)
      (effects (font (size 1.27 1.27)) hide)
    )
  )

  (symbol
    (lib_id "Device:C")
    (at 193.04 68.58 0)
    (unit 1)
    (exclude_from_sim no)
    (in_bom yes)
    (on_board yes)
    (dnp no)
    (uuid "c-hse-1")
    (property "Reference" "C10"
      (at 195.58 66.04 0)
      (effects (font (size 1.27 1.27)) (justify left))
    )
    (property "Value" "20pF"
      (at 195.58 68.58 0)
      (effects (font (size 1.27 1.27)) (justify left))
    )
    (property "Footprint" "Capacitor_SMD:C_0402_1005Metric"
      (at 193.04 68.58 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "LCSC" "C1552"
      (at 193.04 68.58 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "JLC_Basic" "Yes"
      (at 193.04 68.58 0)
      (effects (font (size 1.27 1.27)) hide)
    )
  )

  (symbol
    (lib_id "Device:C")
    (at 213.36 68.58 0)
    (unit 1)
    (exclude_from_sim no)
    (in_bom yes)
    (on_board yes)
    (dnp no)
    (uuid "c-hse-2")
    (property "Reference" "C11"
      (at 215.9 66.04 0)
      (effects (font (size 1.27 1.27)) (justify left))
    )
    (property "Value" "20pF"
      (at 215.9 68.58 0)
      (effects (font (size 1.27 1.27)) (justify left))
    )
    (property "Footprint" "Capacitor_SMD:C_0402_1005Metric"
      (at 213.36 68.58 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "LCSC" "C1552"
      (at 213.36 68.58 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "JLC_Basic" "Yes"
      (at 213.36 68.58 0)
      (effects (font (size 1.27 1.27)) hide)
    )
  )


  (text "Power Decoupling"
    (exclude_from_sim no)
    (at 190.5 88.9 0)
    (effects (font (size 2 2) bold) (justify left))
    (uuid "text-decoupling-title")
  )

  (text "VDD Decoupling (x4):\n100nF 0402 on each VDD pin\nLCSC: C1525 (Basic)\n\nVDDA Decoupling:\n4.7uF + 100nF\nLCSC: C23733 + C1525\n\nVCAP:\n2x 1uF on VCAP1/VCAP2\nLCSC: C52923"
    (exclude_from_sim no)
    (at 190.5 101.6 0)
    (effects (font (size 1.27 1.27)) (justify left))
    (uuid "text-decoupling-note")
  )

  (symbol
    (lib_id "Device:C")
    (at 241.3 104.14 0)
    (unit 1)
    (exclude_from_sim no)
    (in_bom yes)
    (on_board yes)
    (dnp no)
    (uuid "c-vdd-1")
    (property "Reference" "C12"
      (at 243.84 101.6 0)
      (effects (font (size 1.27 1.27)) (justify left))
    )
    (property "Value" "100nF"
      (at 243.84 104.14 0)
      (effects (font (size 1.27 1.27)) (justify left))
    )
    (property "Footprint" "Capacitor_SMD:C_0402_1005Metric"
      (at 241.3 104.14 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "LCSC" "C1525"
      (at 241.3 104.14 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "JLC_Basic" "Yes"
      (at 241.3 104.14 0)
      (effects (font (size 1.27 1.27)) hide)
    )
  )

  (symbol
    (lib_id "Device:C")
    (at 254 104.14 0)
    (unit 1)
    (exclude_from_sim no)
    (in_bom yes)
    (on_board yes)
    (dnp no)
    (uuid "c-vdda")
    (property "Reference" "C13"
      (at 256.54 101.6 0)
      (effects (font (size 1.27 1.27)) (justify left))
    )
    (property "Value" "4.7uF"
      (at 256.54 104.14 0)
      (effects (font (size 1.27 1.27)) (justify left))
    )
    (property "Footprint" "Capacitor_SMD:C_0402_1005Metric"
      (at 254 104.14 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "LCSC" "C23733"
      (at 254 104.14 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "JLC_Basic" "Yes"
      (at 254 104.14 0)
      (effects (font (size 1.27 1.27)) hide)
    )
  )


  (text "Reset Circuit"
    (exclude_from_sim no)
    (at 38.1 139.7 0)
    (effects (font (size 2 2) bold) (justify left))
    (uuid "text-reset-title")
  )

  (symbol
    (lib_id "Switch:SW_Push")
    (at 55.88 157.48 0)
    (unit 1)
    (exclude_from_sim no)
    (in_bom yes)
    (on_board yes)
    (dnp no)
    (uuid "sw-reset")
    (property "Reference" "SW1"
      (at 55.88 149.86 0)
      (effects (font (size 1.27 1.27)))
    )
    (property "Value" "RESET"
      (at 55.88 152.4 0)
      (effects (font (size 1.27 1.27)))
    )
    (property "Footprint" "Button_Switch_SMD:SW_SPST_TL3342"
      (at 55.88 157.48 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "LCSC" "C318884"
      (at 55.88 157.48 0)
      (effects (font (size 1.27 1.27)) hide)
    )
  )

  (symbol
    (lib_id "Device:R")
    (at 76.2 149.86 0)
    (unit 1)
    (exclude_from_sim no)
    (in_bom yes)
    (on_board yes)
    (dnp no)
    (uuid "r-reset")
    (property "Reference" "R10"
      (at 78.74 147.32 0)
      (effects (font (size 1.27 1.27)) (justify left))
    )
    (property "Value" "10k"
      (at 78.74 149.86 0)
      (effects (font (size 1.27 1.27)) (justify left))
    )
    (property "Footprint" "Resistor_SMD:R_0402_1005Metric"
      (at 76.2 149.86 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "LCSC" "C25744"
      (at 76.2 149.86 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "JLC_Basic" "Yes"
      (at 76.2 149.86 0)
      (effects (font (size 1.27 1.27)) hide)
    )
  )

  (symbol
    (lib_id "Device:C")
    (at 88.9 157.48 0)
    (unit 1)
    (exclude_from_sim no)
    (in_bom yes)
    (on_board yes)
    (dnp no)
    (uuid "c-reset")
    (property "Reference" "C14"
      (at 91.44 154.94 0)
      (effects (font (size 1.27 1.27)) (justify left))
    )
    (property "Value" "100nF"
      (at 91.44 157.48 0)
      (effects (font (size 1.27 1.27)) (justify left))
    )
    (property "Footprint" "Capacitor_SMD:C_0402_1005Metric"
      (at 88.9 157.48 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "LCSC" "C1525"
      (at 88.9 157.48 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "JLC_Basic" "Yes"
      (at 88.9 157.48 0)
      (effects (font (size 1.27 1.27)) hide)
    )
  )


  (text "USB Full-Speed (Data Only)"
    (exclude_from_sim no)
    (at 127 139.7 0)
    (effects (font (size 2 2) bold) (justify left))
    (uuid "text-usb-title")
  )

  (text "USB Connections:\n• PA11: USB_DM\n• PA12: USB_DP\n\nFreed UCPD Pins (UCPD not used):\n• PB4: TPS25750D_INT (optional)\n• PB5: GPIO_SPARE (reserved)\n\nNote: USB Power Delivery is handled\nby the standalone TPS25750D controller.\nSTM32 UCPD peripheral unused.\n\nESD Protection:\nUSBLC6-2SC6 (C7519)\nBasic part, protects D+/D-"
    (exclude_from_sim no)
    (at 127 154.94 0)
    (effects (font (size 1.27 1.27)) (justify left))
    (uuid "text-usb-note")
  )


  (text "Analog Inputs"
    (exclude_from_sim no)
    (at 38.1 190.5 0)
    (effects (font (size 2 2) bold) (justify left))
    (uuid "text-analog-title")
  )

  (text "ADC Channels:\n• PC0 (ADC1_IN6): SWR Forward\n• PC1 (ADC1_IN7): SWR Reverse\n• PC2 (ADC1_IN8): Audio Input\n• PB0 (ADC1_IN15): Battery Voltage\n\nDAC Channels:\n• PA4 (DAC1_OUT1): Audio Output\n• PA5 (DAC1_OUT2): Spare/Reference\n\nOp-Amp (for Audio):\nLM358 or similar\nLCSC: C7950 (Basic)"
    (exclude_from_sim no)
    (at 38.1 205.74 0)
    (effects (font (size 1.27 1.27)) (justify left))
    (uuid "text-analog-note")
  )


  (text "GPIO Pin Assignments"
    (exclude_from_sim no)
    (at 190.5 139.7 0)
    (effects (font (size 2 2) bold) (justify left))
    (uuid "text-gpio-title")
  )

  (text "Port A:\n PA0  - PTT Input (EXTI)\n PA1  - Band Relay SET 0\n PA2  - Band Relay SET 1\n PA3  - Band Relay SET 2\n PA4  - DAC1_OUT1 (Audio Out)\n PA5  - DAC1_OUT2\n PA6  - Band Relay RESET 0\n PA7  - Band Relay RESET 1\n PA8  - MCO1 (Debug Clock Out)\n PA9  - USART1_TX\n PA10 - USART1_RX\n PA11 - USB_DM\n PA12 - USB_DP\n PA13 - SWDIO\n PA14 - SWCLK\n PA15 - JTAG_TDI\n\nPort B:\n PB0  - ADC (VBAT Sense)\n PB1  - TX Enable\n PB2  - BOOT0 (tie low)\n PB3  - JTAG_TDO/SWO\n PB4  - TPS25750D_INT (GPIO, optional)\n PB5  - GPIO_SPARE (reserved)\n PB6  - I2C1_SCL\n PB7  - I2C1_SDA\n PB8  - Band Relay RESET 2\n PB9  - Band Relay SET 3\n PB10 - Band Relay RESET 3\n PB11 - Band Relay SET 4\n PB12 - Band Relay RESET 4\n PB13 - SPI2_SCK\n PB14 - SPI2_MISO\n PB15 - SPI2_MOSI\n\nPort C:\n PC0  - ADC1_IN6 (SWR FWD)\n PC1  - ADC1_IN7 (SWR REV)\n PC2  - ADC1_IN8 (Audio In)\n PC3  - Encoder A\n PC4  - Encoder B\n PC5  - Encoder Push\n PC6  - HRTIM1_CH1 (PWM to PA)\n PC7  - HRTIM1_CH2\n PC8  - T/R Switch Control\n PC9  - LED Status\n PC10 - UART4_TX (CAT)\n PC11 - UART4_RX (CAT)\n PC12 - SPI3_MOSI (Flash)\n PC13 - RTC_OUT\n PC14 - OSC32_IN\n PC15 - OSC32_OUT\n\nPort D:\n PD2  - SPI3_MISO"
    (exclude_from_sim no)
    (at 190.5 152.4 0)
    (effects (font (size 1 1)) (justify left))
    (uuid "text-gpio-detail")
  )


  (text "I2C1 Bus Devices"
    (exclude_from_sim no)
    (at 330.2 30.48 0)
    (effects (font (size 2 2) bold) (justify left))
    (uuid "text-i2c-title")
  )

  (text "STM32 I2C1 @ 400kHz (Host Bus):\n• 0x60 - Si5351A (Clock Gen)\n• 0x21 - TPS25750D (USB-PD, I2CS port)\n• 0x6B - BQ25798 (Charger, monitoring)\n• 0x08 - BQ76920 (Battery AFE)\n• 0x3C - SSD1306 (OLED, optional)\n\nTPS25750D I2CM (Charger Control):\n• 0x6B - BQ25798 (autonomous config)\n\nNote: TPS25750D autonomously controls\nBQ25798 via its I2CM port. STM32 can\nmonitor charger status via shared bus.\n\nPull-ups: 2.2k on SCL/SDA\nLCSC: C25879 (Basic 0402)"
    (exclude_from_sim no)
    (at 330.2 45.72 0)
    (effects (font (size 1.27 1.27)) (justify left))
    (uuid "text-i2c-note")
  )

  (symbol
    (lib_id "Device:R")
    (at 355.6 88.9 0)
    (unit 1)
    (exclude_from_sim no)
    (in_bom yes)
    (on_board yes)
    (dnp no)
    (uuid "r-i2c-scl")
    (property "Reference" "R20"
      (at 358.14 86.36 0)
      (effects (font (size 1.27 1.27)) (justify left))
    )
    (property "Value" "2.2k"
      (at 358.14 88.9 0)
      (effects (font (size 1.27 1.27)) (justify left))
    )
    (property "Footprint" "Resistor_SMD:R_0402_1005Metric"
      (at 355.6 88.9 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "LCSC" "C25879"
      (at 355.6 88.9 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "JLC_Basic" "Yes"
      (at 355.6 88.9 0)
      (effects (font (size 1.27 1.27)) hide)
    )
  )

  (symbol
    (lib_id "Device:R")
    (at 368.3 88.9 0)
    (unit 1)
    (exclude_from_sim no)
    (in_bom yes)
    (on_board yes)
    (dnp no)
    (uuid "r-i2c-sda")
    (property "Reference" "R21"
      (at 370.84 86.36 0)
      (effects (font (size 1.27 1.27)) (justify left))
    )
    (property "Value" "2.2k"
      (at 370.84 88.9 0)
      (effects (font (size 1.27 1.27)) (justify left))
    )
    (property "Footprint" "Resistor_SMD:R_0402_1005Metric"
      (at 368.3 88.9 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "LCSC" "C25879"
      (at 368.3 88.9 0)
      (effects (font (size 1.27 1.27)) hide)
    )
    (property "JLC_Basic" "Yes"
      (at 368.3 88.9 0)
      (effects (font (size 1.27 1.27)) hide)
    )
  )


  (hierarchical_label "+3V3"
    (shape input)
    (at 25.4 50.8 180)
    (effects (font (size 1.524 1.524)) (justify right))
    (uuid "hlabel-mcu-3v3")
  )

  (hierarchical_label "I2C1_SCL"
    (shape bidirectional)
    (at 381 76.2 0)
    (effects (font (size 1.524 1.524)) (justify left))
    (uuid "hlabel-mcu-scl")
  )

  (hierarchical_label "I2C1_SDA"
    (shape bidirectional)
    (at 381 88.9 0)
    (effects (font (size 1.524 1.524)) (justify left))
    (uuid "hlabel-mcu-sda")
  )

  (hierarchical_label "PWM_PA"
    (shape output)
    (at 381 101.6 0)
    (effects (font (size 1.524 1.524)) (justify left))
    (uuid "hlabel-mcu-pwm")
  )

  (hierarchical_label "BAND_SEL[0..4]"
    (shape output)
    (at 381 114.3 0)
    (effects (font (size 1.524 1.524)) (justify left))
    (uuid "hlabel-mcu-band")
  )

  (hierarchical_label "USB_DP"
    (shape bidirectional)
    (at 381 127 0)
    (effects (font (size 1.524 1.524)) (justify left))
    (uuid "hlabel-mcu-usb-dp")
  )

  (hierarchical_label "USB_DM"
    (shape bidirectional)
    (at 381 139.7 0)
    (effects (font (size 1.524 1.524)) (justify left))
    (uuid "hlabel-mcu-usb-dm")
  )

  (hierarchical_label "TPS_INT"
    (shape input)
    (at 381 152.4 0)
    (effects (font (size 1.524 1.524)) (justify left))
    (uuid "hlabel-tps-int")
  )

)
